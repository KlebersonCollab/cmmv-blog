importScripts("https://storage.googleapis.com/workbox-cdn/releases/6.5.4/workbox-sw.js");const{registerRoute:e,NavigationRoute:t,Route:r,setCatchHandler:n,setDefaultHandler:s}=workbox.routing,{CacheFirst:a,NetworkFirst:o,StaleWhileRevalidate:i}=workbox.strategies,{ExpirationPlugin:c}=workbox.expiration,{CacheableResponsePlugin:l}=workbox.cacheableResponse,{BackgroundSyncPlugin:h}=workbox.backgroundSync,{skipWaiting:u,clientsClaim:d}=workbox.core;self.addEventListener("install",e=>{e.waitUntil(self.skipWaiting())}),d();const VERSION="v0.1.2",CACHE_NAMES={ASSETS:"assets-cache-"+VERSION,STATIC:"static-cache-"+VERSION,LAST_VISITED:"last-visited-"+VERSION,COUPONS:`coupons-pages-${VERSION}-${(new Date).toLocaleDateString("pt-BR").replace(/\//g,"")}`,OFFLINE_QUEUE:"offline-queue-"+VERSION},ROUTE_REGEX={IMAGES:/\.(?:png|jpg|jpeg|svg|gif|webp)$/i,ASSETS:/\.(?:js|css|woff2?|eot|ttf|otf|map)$/i,COUPONS:/(?:\?|&)c=(\d+)(?:&|#|$)/,LAST_VISITED:/.*(?:static\.com\.br\/widget\/lastvisitedstores)/},AD_DOMAINS=["adtrafficquality.google","googleadservices.com","googlesyndication.com","doubleclick.net","pswec.com","adsystem.com","pangle.io","pangle.com","pangle.cn","pangle.com.cn","sodar","pagead"],assetsExpirationPlugin=new c({maxEntries:100,maxAgeSeconds:2592e3,purgeOnQuotaError:!0}),imagesExpirationPlugin=new c({maxEntries:100,maxAgeSeconds:5184e3,purgeOnQuotaError:!0}),couponsExpirationPlugin=new c({maxEntries:40,maxAgeSeconds:1800,purgeOnQuotaError:!0}),lastVisitedStoresExpirationPlugin=new c({maxEntries:8,maxAgeSeconds:60,purgeOnQuotaError:!0});function isAdRequest(e){return AD_DOMAINS.some(t=>e.includes(t))}e(({url:e})=>isAdRequest(e.href),async()=>new Response("",{status:204,statusText:"Ad Blocked by Service Worker"})),e(({request:e})=>"image"===e.destination||ROUTE_REGEX.IMAGES.test(e.url),new a({cacheName:"images-cache-"+VERSION,plugins:[new l({statuses:[200]}),imagesExpirationPlugin]})),e(({url:e})=>"https://fonts.gstatic.com"===e.origin,new a({cacheName:"google-fonts",plugins:[new l({statuses:[200]}),new c({maxEntries:20})]})),e(ROUTE_REGEX.COUPONS,new a({cacheName:CACHE_NAMES.COUPONS,plugins:[new h(CACHE_NAMES.OFFLINE_QUEUE,{maxRetentionTime:1440}),couponsExpirationPlugin]})),e(ROUTE_REGEX.LAST_VISITED,new a({cacheName:CACHE_NAMES.LAST_VISITED,plugins:[lastVisitedStoresExpirationPlugin]})),self.addEventListener("fetch",e=>{const t=e.request.url;isAdRequest(t)&&e.respondWith(new Response("",{status:204,statusText:"No Content"}))}),n(({event:e})=>{const t=e.request.url;return isAdRequest(t)?new Response("",{status:204,statusText:"Ad Blocked"}):caches.match("/offline.html")||new Response("Offline",{status:503,statusText:"Service Unavailable"})}),self.addEventListener("message",e=>{"clear_coupons"===e.data?couponsExpirationPlugin.deleteCacheAndMetadata().finally(()=>{e.source.postMessage("coupons_cleared")}):"clear_assets"===e.data?assetsExpirationPlugin.deleteCacheAndMetadata().finally(()=>{e.source.postMessage("assets_cleared")}):"logout"===e.data?lastVisitedStoresExpirationPlugin.deleteCacheAndMetadata().finally(()=>{e.source.postMessage("last_visited_cleared")}):e.data?.type==="force_update"&&(self.skipWaiting(),d())});